# üìä –û—Ç—á–µ—Ç –æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –£–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚ùå –£–¥–∞–ª–µ–Ω–∞ –ø–∞–ø–∫–∞ `ViewModels/` (5 —Ñ–∞–π–ª–æ–≤):
  - `ArticlesViewModel.swift`
  - `ChatViewModel.swift`
  - `RitualViewModel.swift`
  - `SettingsViewModel.swift`
  - `StatisticsViewModel.swift`
- ‚ùå –£–¥–∞–ª–µ–Ω `ContentView.swift` (–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Ñ–∞–π–ª)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** -600 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

### 2. –ú–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π

#### Script.swift
- ‚úÖ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω –∏–∑ `struct` –≤ `@Model final class`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–≤—è–∑—å `@Relationship` —Å ScriptStep
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ SwiftData
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `createStartScript(in:)` –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

#### ChatMessage.swift
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —á–µ—Ä–µ–∑ extension:
  - `createMessage(body:isFromUser:in:)` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
  - `generateEvaResponse(for:)` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ Eva

### 3. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Views

#### ChatView.swift
- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç ChatViewModel
- ‚úÖ –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `@Query(sort: \ChatMessage.date)`
- ‚úÖ –í—Å—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ View –∫–∞–∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö

#### –û—Å—Ç–∞–ª—å–Ω—ã–µ Views
- ‚úÖ ArticlesView - —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª @Query (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- ‚úÖ RitualView - —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª @Query (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- ‚úÖ SettingsView - —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª @Query (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SwiftData Schema

```swift
let schema = Schema([
    ChatMessage.self,
    Ritual.self,
    RitualLine.self,
    Article.self,
    Statistic.self,
    AppSettings.self,
    Script.self,        // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
    ScriptStep.self     // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
])
```

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ | 23 | 16 | **-30%** |
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | ~2000 | ~1400 | **-30%** |
| –°–ª–æ—ë–≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã | 3 (Model-ViewModel-View) | 2 (Model-View) | **-33%** |
| –§–∞–π–ª–æ–≤ ViewModels | 5 | 0 | **-100%** |

---

## üéØ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º Apple

### ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- `@Model` –º–∞–∫—Ä–æ—Å –¥–ª—è –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö
- `@Query` –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- `@Observable` –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π (iOS 17+)
- `@Relationship` –¥–ª—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
- SwiftData –≤–º–µ—Å—Ç–æ Core Data
- –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ `@Environment(\.modelContext)`

### ‚ùå –£–±—Ä–∞–Ω–æ:
- MVVM –ø–∞—Ç—Ç–µ—Ä–Ω (—É—Å—Ç–∞—Ä–µ–ª —Å –ø–æ—è–≤–ª–µ–Ω–∏–µ–º SwiftData)
- `ObservableObject` –ø—Ä–æ—Ç–æ–∫–æ–ª
- `@Published` property wrappers
- `@StateObject` –¥–ª—è ViewModels
- –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π

---

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ú–µ–Ω—å—à–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å–ª–æ–µ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ SwiftData
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É ViewModel –∏ View

### 2. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å
- –ú–µ–Ω—å—à–µ –∫–æ–¥–∞ = –º–µ–Ω—å—à–µ –±–∞–≥–æ–≤
- –ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
- –õ–µ–≥—á–µ onboarding –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### 3. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ –º–æ–¥–µ–ª—è—Ö –ª–µ–≥—á–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
- –ù–µ –Ω—É–∂–Ω—ã –º–æ–∫–∏ ViewModels
- Unit-—Ç–µ—Å—Ç—ã –¥–ª—è static –º–µ—Ç–æ–¥–æ–≤ –≤ models

### 4. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- –°–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –≥–∞–π–¥–ª–∞–π–Ω–∞–º Apple
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Swift 6 –∏ iOS 18+
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ–∏—á–∏

---

## üìö –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
sleep course/
‚îú‚îÄ‚îÄ üìÅ Models/          ‚Üê –ú–æ–¥–µ–ª–∏ + –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ Article.swift
‚îÇ   ‚îú‚îÄ‚îÄ ChatMessage.swift     [–æ–±–Ω–æ–≤–ª–µ–Ω ‚úÖ]
‚îÇ   ‚îú‚îÄ‚îÄ Ritual.swift
‚îÇ   ‚îú‚îÄ‚îÄ Script.swift          [–æ–±–Ω–æ–≤–ª–µ–Ω ‚úÖ]
‚îÇ   ‚îú‚îÄ‚îÄ Settings.swift
‚îÇ   ‚îî‚îÄ‚îÄ Statistic.swift
‚îÇ
‚îú‚îÄ‚îÄ üìÅ Views/           ‚Üê –¢–æ–ª—å–∫–æ UI –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ MainTabView.swift
‚îÇ   ‚îú‚îÄ‚îÄ ChatView.swift        [–æ–±–Ω–æ–≤–ª–µ–Ω ‚úÖ]
‚îÇ   ‚îú‚îÄ‚îÄ ArticlesView.swift
‚îÇ   ‚îú‚îÄ‚îÄ ArticleDetailView.swift
‚îÇ   ‚îú‚îÄ‚îÄ RitualView.swift
‚îÇ   ‚îî‚îÄ‚îÄ SettingsView.swift
‚îÇ
‚îî‚îÄ‚îÄ üìÑ sleep_courseApp.swift  [–æ–±–Ω–æ–≤–ª–µ–Ω ‚úÖ]
```

---

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –î–æ (MVVM):
```swift
// ViewModel
@Observable class ChatViewModel {
    var messages: [ChatMessage] = []
    
    func loadMessages() {
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
    }
}

// View
struct ChatView: View {
    @State private var viewModel: ChatViewModel?
    
    var body: some View {
        List(viewModel?.messages ?? []) { message in
            // ...
        }
        .onAppear {
            viewModel = ChatViewModel(modelContext: modelContext)
        }
    }
}
```

### –ü–æ—Å–ª–µ (Modern SwiftUI):
```swift
// Model
extension ChatMessage {
    static func createMessage(...) -> ChatMessage {
        // –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è
    }
}

// View
struct ChatView: View {
    @Query(sort: \ChatMessage.date) private var messages: [ChatMessage]
    
    var body: some View {
        List(messages) { message in
            // ...
        }
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ!
    }
}
```

---

## ‚ö†Ô∏è Breaking Changes

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:
1. –í—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ ViewModels –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@Query` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
3. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤—ã–∑—ã–≤–∞—Ç—å –∏–∑ static –º–µ—Ç–æ–¥–æ–≤ –º–æ–¥–µ–ª–µ–π

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
- **–ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π** - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ
- –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ SwiftData –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞
2. ‚úÖ –ö–æ–¥ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω
3. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
4. ‚è≠Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. ‚è≠Ô∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤

---

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ: `ARCHITECTURE.md`

---

**–î–∞—Ç–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:** 22.10.2025  
**–í–µ—Ä—Å–∏—è:** 2.0  
**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è iOS:** 17.0+

